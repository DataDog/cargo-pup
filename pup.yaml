#
# Rules for this project, cargo-pup.
#

# Implementations of our lint rules ... 
architecture_lint_rules:
  type: trait_impl
  source_name: "^pup_driver::lints::architecture_lint_rule::ArchitectureLintRule"
  # Must be named consistently
  name_must_match: ".*LintProcessor$"
  # ... and must be public
  enforce_visibility: "Private"
  severity: Error

# Implementations of our lint factories
configuration_factories:
  type: trait_impl
  source_name: "^pup_driver::lints::configuration_factory::LintFactory"
  # ... must be named consistently
  name_must_match: ".*LintFactory$"
  # ... and must be private
  enforce_visibility: "Private"
  severity: Error

# Our namespaces that follow the mod.rs structure
# must be empty. That is, they should only contain nested
# module references, uses, and re-exports
empty_mods:
  type: empty_mod
  modules:
    - ".*"
  severity: Warn

# Keep helpers implementation details private
helpers_no_structs_or_traits:
  type: item_type
  modules:
    - "^pup_driver::lints::helpers$"
  denied_items:
    - struct  
    - trait 
  severity: Error

utils_no_structs_or_traits:
  type: item_type
  modules:
    - "^pup_driver::utils$"
  denied_items:
    - struct
    - trait 
  severity: Error

# Ensure correct Result error types across the project
enforce_result_error:
  type: result_error
  modules:
    - ".*"
  severity: Error

# Prevent cargo-pup from importing anything from lints.
# Lints needs rustc internals, which we can never allow in cargo-pup,
# because of the need for the rustup bootstrapping process to deal with
# dynamic linking.
cargo_pup_no_lints_imports:
  type: module_usage
  modules:
    - "^cargo_pup::"  # Apply this rule to all cargo_pup modules
  rules:
    - type: Deny
      denied_modules:
        - "::lints"  # Deny importing anything from lints directory
      severity: Error
